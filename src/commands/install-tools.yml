description: Install octo cli on current image.
steps:
  - run:
      name: Install Octo CLI
      command: |
        if [[ $EUID == 0 ]]; then export SUDO=""; else export SUDO="sudo"; fi

        ID=$(grep -oP '(?<=^ID=).+' /etc/os-release | tr -d '"' | tr '[:upper:]' '[:lower:]')

        case $ID in
          ubuntu | debian)
            $CODENAME=$(grep -oP '(?<=^VERSION_CODENAME=).+' /etc/os-release | tr -d '"' | tr '[:upper:]' '[:lower:]')
            $SUDO apt update && $SUDO apt -y install --no-install-recommends software-properties-common gnupg apt-transport-https
            $SUDO apt-key adv --fetch-keys https://apt.octopus.com/public.key
            $SUDO add-apt-repository "deb https://apt.octopus.com/ $CODENAME main"
            $SUDO apt update && $SUDO apt -y install octopuscli
          centos | rhel | fedora)
            $SUDO curl -sSfL https://rpm.octopus.com/octopuscli.repo -o /etc/yum.repos.d/octopuscli.repo
            $SUDO yum install octopuscli -y
          *)
            echo "Unknown distribution: $ID";;
        esac
